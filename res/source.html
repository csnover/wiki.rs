<!DOCTYPE html>
<html lang="en" class="syntect-code">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta http-equiv="content-security-policy" content="img-src 'self' data:; style-src 'self' 'unsafe-inline'; default-src 'self'; upgrade-insecure-requests">
        <title>wiki.rs</title>
        <link rel="stylesheet" href="<%= base_path %>/styles.css">
        <style>
            :root {
                --bottom-panel: 8rlh;
                padding: 1rem;
            }

            table {
                align-items: baseline;
                display: grid;
                grid-template-columns: min-content min-content auto;
                gap: 0 0.5rem;

                tbody, tr {
                    display: contents;
                }

                td {
                    vertical-align: top;
                    &:first-child, &:nth-child(2) {
                        font-family: var(--sans);
                        font-variant-numeric: tabular-nums;
                        user-select: none;
                    }
                }

                code {
                    white-space: pre-wrap;
                }
            }

            button {
                all: unset;
                align-self: end;
                background-color: var(--border-fg);
                border: 1px outset;
                color: var(--fg);
                cursor: pointer;
                font-family: var(--sans);
                outline: initial;
                padding: 0 .5em;
                user-select: none;

                &:active {
                    background-color: lch(from var(--border-fg) calc(l - 20) c h);
                    border-style: inset;
                }
            }

            form {
                border-top: thick solid;
                bottom: 0;
                display: flex;
                height: var(--bottom-panel);
                left: 0;
                padding: .5em;
                position: fixed;
                right: 0;
            }

            .inputs,
            .boopables {
                display: flex;
                flex-direction: column;

                > :first-child {
                    flex: 1;
                }
            }

            .inputs {
                flex: 1;
            }

            .boopables {
                justify-content: end;

                > :first-child {
                    line-height: 1.2;
                    margin-left: 1.2em;
                    margin-bottom: .5em;
                    text-indent: -1.2em;
                }
            }

            textarea {
                background: inherit;
                border: none;
                color: inherit;
                font-family: var(--mono);
                resize: none;

                + textarea {
                    border-top: thin solid var(--border-fg);
                    min-height: calc(var(--bottom-panel) * .25);
                    padding-top: .5em;
                }
            }

            label:has(input) {
                cursor: pointer;
            }

            table:has(+ form) {
                margin-bottom: var(--bottom-panel);
            }

            <%= crate::pages::filter::css(&css) %>
        </style>
    </head>
    <body>
        <table class="syntect-code">
            <%
                let mut lines = lines;
                while let Some((offset, line, code)) = lines.next().transpose()? {
            %>
                <tr>
                    <td><small><%- offset %></small></td>
                    <td><%- line %></td>
                    <td><code><%- code %></code></td>
                </tr>
            <% } %>
        </table>
        <% if let Some(form) = form { %>
            <form method="post" class="syntect-code">
                <div class="inputs">
                    <textarea name="code" autofocus autocorrect="off" autocomplete="off" placeholder="Wikitext goes here, to increase and/or reduce confusion"><%= form.code %></textarea>
                    <textarea name="args" autocorrect="off" autocomplete="off" placeholder="Optional template arguments, in the usual k=v|1=b|2|3 format"><%= form.args %></textarea>
                </div>
                <div class="boopables">
                    <div><label><input name="tree" value="true" type="checkbox"<% if form.tree == Some(true) { %> checked<% } %>> Show PP<br>tree (hehe)</label></div>
                    <button><%- if time::UtcDateTime::now().second() & 1 == 1 { "Pray" } else { "Weep" } %></button>
                </div>
            </form>
        <% } %>
    </body>
</html>
