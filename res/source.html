<!DOCTYPE html>
<html lang="en" class="syntect-code">
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <meta http-equiv="content-security-policy" content="img-src 'self' data:; style-src 'self' 'unsafe-inline'; default-src 'self'; upgrade-insecure-requests">
        <title>wiki.rs</title>
        <link rel="stylesheet" href="<%= base_path %>/styles.css">
        <style>
            :root { padding: 1rem; }

            table {
                align-items: baseline;
                display: grid;
                grid-template-columns: min-content min-content auto;
                gap: 0 0.5rem;

                tbody, tr {
                    display: contents;
                }

                td {
                    vertical-align: top;
                    &:first-child, &:nth-child(2) {
                        font-family: var(--sans);
                        font-variant-numeric: tabular-nums;
                        user-select: none;
                    }
                }

                code {
                    white-space: pre-wrap;
                }
            }

            button {
                all: unset;
                align-self: end;
                background-color: var(--border-fg);
                border: 1px outset;
                color: var(--fg);
                cursor: pointer;
                font-family: var(--sans);
                outline: initial;
                padding: 0 .5em;
                user-select: none;

                &:active {
                    background-color: lch(from var(--border-fg) calc(l - 20) c h);
                    border-style: inset;
                }
            }

            form {
                border-top: thick solid;
                bottom: 0;
                display: flex;
                left: 0;
                padding: .5em;
                position: fixed;
                right: 0;
            }

            textarea {
                background: inherit;
                border: none;
                color: inherit;
                font-family: var(--mono);
                flex: 1;
                min-height: 8lh;
                resize: none;
            }

            <%= crate::pages::filter::css(&css) %>
        </style>
    </head>
    <body>
        <table class="syntect-code">
            <%
                let mut lines = lines;
                while let Some((offset, line, code)) = lines.next().transpose()? {
            %>
                <tr>
                    <td><small><%- offset %></small></td>
                    <td><%- line %></td>
                    <td><code><%- code %></code></td>
                </tr>
            <% } %>
        </table>
        <% if let Some(code) = code { %>
            <form method="post">
                <textarea name="code" autofocus autocorrect="off" autocomplete="off" placeholder="Wikitext goes here, to increase and/or reduce confusion"><%= code %></textarea>
                <button><%- if time::UtcDateTime::now().second() & 1 == 1 { "Pray" } else { "Weep" } %></button>
            </form>
        <% } %>
    </body>
</html>
