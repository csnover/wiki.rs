@font-face {
    font-family: source-serif;
    src: url("fonts/SourceSerif4.woff2") format(woff2);
}
@font-face {
    font-family: source-serif;
    font-style: italic;
    src: url("fonts/SourceSerif4-Italic.woff2") format(woff2);
}
@font-face {
    font-family: archivo;
    size-adjust: 96%;
    src: url("fonts/Archivo.woff2") format(woff2);
}
@font-face {
    font-family: archivo;
    font-style: italic;
    size-adjust: 96%;
    src: url("fonts/Archivo-Italic.woff2") format(woff2);
}
@font-face {
    font-family: inconsolata;
    size-adjust: 106%;
    src: url("fonts/Inconsolata.woff2") format(woff2);
}

*, *::before, *::after {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
}

:root {
    /* You think you can use a repeating-linear-gradient, but then you discover
       that browsers render a pixel horror instead of something beautiful */
    --bar-fill: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="4" height="4"><g stroke="%23000"><line x1="0" x2="4" y1="4" y2="0" /><line x1="-2" x2="2" y1="2" y2="-2" /><line x1="2" x2="6" y1="6" y2="2" /></g></svg>');
    --bar-fill-alt: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="4" height="4"><g stroke="%23000"><line x1="0" x2="4" y1="0" y2="4" /><line x1="2" x2="6" y1="-2" y2="2" /><line x1="-2" x2="2" y1="2" y2="6" /></g></svg>');
    --bar-fill-light: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="4" height="4"><g stroke="%23fff" stroke-width="2"><line x1="0" x2="4" y1="4" y2="0" /><line x1="-2" x2="2" y1="2" y2="-2" /><line x1="2" x2="6" y1="6" y2="2" /></g></svg>');
    --bg: white;
    --body-bottom: 2rem;
    --body-left: 4rem;
    --body-right: 2rem;
    --border-clade: #999;
    --border-fg: lightgrey;
    --bold: 650;
    --border-th: #999;
    --box-margin: 1rem;
    --footer-margin: calc(var(--box-margin) * 4);
    --fg: black;
    --figure-margin: calc(var(--box-margin) * 2);
    --highlight: rebeccapurple;
    --mono: inconsolata, "Segoe UI Mono", "Roboto Mono", monospace, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
    --ol-gutter: 1.5rem;
    /* Bad things happen to the baseline grid if this is not unitless */
    --rlh: 1.55;
    --sans: archivo, system-ui, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
    --serif: source-serif, system-ui, "Segoe UI", Roboto, Helvetica, Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
    --shade-bg: #f9f9f9;

    font: 0.95rem/var(--rlh) var(--serif);
    font-weight: 380;
    font-variant-numeric: oldstyle-nums;
    letter-spacing: -.015rem;
}

:link {
    color: hsl(225, 73%, 22%);
    text-decoration-color: royalblue;
}

:visited {
    color: hsl(270, 50%, 20%);
    text-decoration-color: rebeccapurple;
}

:any-link {
    text-underline-position: from-font;

    &:hover {
        text-decoration-color: transparent;
    }
}

:target:target:target:target {
    background-color: lightyellow;
}

.wiki-rs-body {
    align-items: baseline;
    border-top: .25rem solid var(--highlight);
    display: grid;
    gap: 0 4rem;
    grid-template-columns: auto 18rem;
    padding: 4rem var(--body-right) var(--body-bottom) var(--body-left);
}

.wiki-rs-index {
    align-content: center;
    font-size: 2rem;
    font-weight: 200;
    justify-content: center;
    min-height: 70vh;
}

.wiki-rs-search {
    --border-size: 2px;
    --icon-size: 1.7em;

    border-bottom: var(--border-size) solid currentColor;
    contain: paint style;
    display: flex;
    font-family: var(--sans);
    position: relative;

    &:focus-within {
        border-color: var(--highlight);
        outline: var(--border-size) solid var(--highlight);
    }

    label {
        cursor: text;
        line-height: var(--rlh);
        left: var(--icon-size);
        opacity: .3;
        position: absolute;
        visibility: hidden;
    }

    input {
        --icon-h: calc(1em * 22 / 16);
        --icon-w: calc(1em * 20 / 16);

        all: unset;
        background: transparent url('data:image/svg+xml,<svg viewBox="0 0 20 22" xmlns="http://www.w3.org/2000/svg"><circle cx="12" cy="10" r="6.5" fill="transparent" stroke="black" stroke-width="2.5" vector-effect="non-scaling-stroke"/><line x1="7.5" y1="14.5" x2="2" y2="20" stroke="black" stroke-width="2.5" vector-effect="non-scaling-stroke"/></svg>') 0 center/var(--icon-w) var(--icon-h) no-repeat;
        border: 0;
        box-sizing: border-box;
        color: rgba(0, 0, 0, 0.3);
        flex: 1;
        font-family: var(--sans);
        font-size: 1em;
        height: calc(1em * var(--rlh));
        padding-left: var(--icon-size);

        &::placeholder {
            all: unset;
            font-family: var(--sans);
            opacity: 0;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        &:focus {
            color: var(--fg);

            &::placeholder {
                opacity: .3;
            }
        }

        &:not(:valid, :focus) {
            + label {
                visibility: visible;
            }
        }
    }

    [type=submit] {
        all: unset;
        align-self: baseline;
        border: 1px outset transparent;
        cursor: pointer;
        line-height: calc(1em * var(--rlh) - 3px);
        margin: 1px 1px 1px .25em;
        padding-inline: .25em;
        user-select: none;
        text-decoration: underline;
        visibility: hidden;

        :focus-within > & {
            background-color: var(--shade-bg);
            border-color: var(--border-fg);
            text-decoration: none;
        }

        &:hover, &:focus {
            text-decoration: none;
        }

        &:active {
            background-color: var(--border-fg);
            border-style: inset;
        }
    }

    &:valid [type=submit] {
        visibility: visible;
    }


    /* padding-left of search + input must = --icon-size */
    .wiki-rs-index > & {
        padding-left: .15em;
        max-width: 50vw;
        min-width: 21.4em;

        label {
            opacity: 1;
        }

        input {
            padding-left: 1.55em;
        }

        [type=submit] {
            font-weight: 600;
            font-stretch: 75%;
        }
    }
}

.wiki-rs-title {
    display: flex;
    align-items: baseline;
    grid-column: 1;
    grid-row: 1;

    > * {
        min-width: 0;
    }

    > :first-child {
        flex: 1;
    }

    > .mw-indicators {
        display: flex;
        white-space: nowrap;

        img {
            height: revert-layer;
            vertical-align: bottom;
        }

        > * + * {
            margin-left: 1rem;
        }
    }
}

.wiki-rs-incomplete {
    --icon-h: 1em;
    --icon-w: 1em;
    background: transparent url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48"><path d="M16 13h16c1.1 0 2-.9 2-2s-.9-2-2-2H16c-1.1 0-2 .9-2 2s.9 2 2 2zm0 6h16c1.1 0 2-.9 2-2s-.9-2-2-2H16c-1.1 0-2 .9-2 2s.9 2 2 2zM40 2H8a2 2 0 0 0-2 2v24.8c0 .6.4 1 .9 1.1.3 0 .6-.1.8-.3l4.2-3.9 5.9 5.6 6.2-5.7 5.5 5.1c.4.3 1 .3 1.4 0l5.3-5.1 4.1 3.7c.4.4 1 .4 1.4 0 .2-.2.3-.5.3-.8V4a2 2 0 0 0-2-2zm-2 19.9-1.2-1.1c-.4-.3-1-.3-1.4 0l-5.2 5-5.5-5c-.4-.3-1-.3-1.4 0l-5.4 5-5.3-5c-.4-.3-1-.3-1.4 0L10 22V6h28v15.9zm-2.6 7.9-5.2 5-5.5-5c-.4-.3-1-.3-1.4 0l-5.4 5-5.3-5c-.4-.3-1-.3-1.4 0L6 34.7V44c0 1.1.9 2 2 2h32a2 2 0 0 0 2-2v-9.6l-5.2-4.6c-.4-.3-1-.3-1.4 0zM38 42H10v-5.6l1.9-1.7 5.2 5c.4.3 1 .3 1.4 0l5.5-5.1 5.5 5.1c.4.3 1 .3 1.4 0l5.3-5.1 1.8 1.6V42z"/></svg>') 0 center/var(--icon-w) var(--icon-h) no-repeat;
    font-family: var(--sans);
    padding-left: 1.1em;
    padding-right: .05em;
}

.wiki-rs-nav {
    --top: 2rem;
    display: flex;
    flex-direction: column;
    grid-column: 2;
    grid-row: 1/3;
    max-height: calc(100vh - var(--top) * 2);
    position: sticky;
    top: var(--top);
}

.wiki-rs-toc {
    --scrollbar-padding: .5rem;
    font-family: var(--sans);
    font-size: 105%;
    font-stretch: 80%;
    margin-top: 4rem;
    margin-right: calc(var(--scrollbar-padding) * -1);
    overflow-y: auto;
    padding-right: var(--scrollbar-padding);
    scrollbar-width: thin;
    scrollbar-color: grey transparent;

    ul {
        list-style: none;
        padding-left: 0;
        margin-left: 1rem;

        > * + * {
            margin-top: calc(var(--box-margin) * .25);
        }
    }

    & > ul {
        margin-left: 0;
    }
}

.wiki-rs-content {
    container: main-article / inline-size;
    contain: inline-size layout style paint;
    grid-column: 1;
    grid-row: 2;
    overflow: hidden;
    overflow-wrap: break-word;
    /* weird padding and margin stuff to avoid big overflow (caused by giant
       nowrap tables) whilst allowing small overflow (because normally tables
       and ordered lists bleed into the margins) */
    margin-right: -2rem;
    margin-left: -4rem;
    padding-left: 4rem;
    padding-right: 2rem;
}

.wiki-rs-bye {
    display: flex;
    font-family: var(--sans);
    margin-top: 4rem;

    > svg {
        height: 2.25rlh;
        margin-right: .5rem;
        transform: translateY(-.075rlh);
    }

    > div {
        > :first-child {
            font-weight: 550;
        }

        > hr {
            margin-block: calc(var(--box-margin) * 2) calc(var(--box-margin) * .33);
        }

    }
}

.wiki-rs-pagination {
    --gap: 2em;
    background-color: var(--bg);
    border-top: 3px solid currentColor;
    grid-column: span 2;
    font-family: var(--sans);
    font-variant-numeric: tabular-nums;
    margin-left: calc(var(--body-right) - var(--body-left));
    margin-bottom: calc(var(--body-bottom) * -1);
    margin-top: 4rem;
    padding-bottom: var(--body-bottom);
    padding-top: .5rem;
    position: sticky;
    bottom: 0;

    > ul {
        display: flex;
        gap: var(--gap);
        justify-content: center;
        list-style: none;
        padding: 0;

        > * {
            margin-top: 0;
            padding: 0;
            white-space: nowrap;

            /* Affordance */
            > :any-link {
                margin-inline: -.5em;
                padding-inline: .5em;
            }
        }

        > .first::after,
        > .last::before {
            content: '…';
        }

        > .first::after {
            margin-left: var(--gap);
        }

        > .last::before {
            margin-right: var(--gap);
        }
    }
}

.wiki-rs-search-results {
    column-width: 30em;
    gap: calc(var(--ol-gutter) * 2);
    margin-top: 4rem;
}

.wiki-rs-timeline {
    font-family: var(--sans);
}

.wiki-rs-timeline-main-axis,
.wiki-rs-timeline-cross-axis {
    font-variant-numeric: lining-nums;
}

abbr {
    cursor: help;
    text-decoration: underline dotted;
}

table {
    border-collapse: collapse;
}

hr {
    border: solid currentColor;
    border-width: thin 0 0;
}

img {
    height: auto;
}

cite {
    font-style: normal;
}

code, kbd, pre, samp, tt {
    font-family: var(--mono);
}

sub {
    position: relative;
    top: .125em;
    vertical-align: baseline;
}

sup {
    position: relative;
    top: -.5em;
    vertical-align: baseline;
}

math {
    font-family: var(--serif);
}

pre {
    hyphens: none;
    tab-size: 4;
    white-space: pre-wrap;
    word-wrap: break-word;
}

b, strong {
    font-weight: var(--bold);
}

h1, h2, h3, h4, h5, h6 {
    font-family: var(--sans);
    font-variant-numeric: normal;
    hyphens: none;
}

h1 {
    font-size: 3.5rem;
    font-stretch: 80%;
    font-weight: 200;
    line-height: 1.1;
}

h2 {
    border-top: 3px solid currentColor;
    clear: left;
    font-size: 1.5rem;
    font-stretch: semi-expanded;
    line-height: 1rlh;
    margin-right: auto;
    padding: .1rlh 0 .4rlh;
    width: fit-content;

    + * {
        margin-top: var(--box-margin);
    }

    + h3 {
        margin-top: 0;
    }
}

h3 {
    font-size: 1rem;
    font-stretch: 150%;
    text-transform: uppercase;
}

h5 {
    font-size: 0.83em;
    font-stretch: 150%;
    text-transform: uppercase;
}

h6 {
    font-size: 0.83em;
    font-stretch: 120%;
}

dt {
    font-family: var(--sans);
}

th {
    font-family: var(--sans);
    hyphens: none;
}

.reference {
    font-family: var(--sans);
    font-size: 75%;
    font-variant-numeric: normal;
    position: relative;
    text-decoration: none;
    top: -.5em;
    white-space: nowrap;

    &::before {
        content: '[';
    }

    &::after {
        content: ']';
    }
}

.references,
.wiki-rs-search-results ol {
    margin-inline-start: calc(var(--ol-gutter) * -1);

    > *::marker {
        font-family: var(--sans);
        font-size: 83%;
        font-variant-numeric: tabular-nums;
    }
}

/* overrides for garbage <templatestyle> injections */
.mw-parser-output {
    --aside-gutter-align: translateX(min(0%, calc(var(--aside-max) * -1 + 100%)));
    --aside-max: calc(100cqw - var(--figure-margin) - var(--max-width));
    --aside-min: 23rem;
    --background-color-base: transparent;
    --background-color-interactive-subtle: transparent;
    --background-color-neutral: transparent;
    --background-color-neutral-subtle: transparent;
    --border-color-base: var(--border-fg);
    --border-color-subtle: transparent;
    --box-tag: transparent linear-gradient(135deg, var(--fg) var(--tag-size), transparent var(--tag-size)) 0%/calc(var(--tag-size) * 2) no-repeat;
    --color-base: #000;
    --color-subtle: var(--color-base);
    --max-width: 70rem;
    --side-table-stretch: 80%;
    --table-margin-inline: calc(var(--table-padding-inline) * -1);
    --table-padding-block: .1rem;
    --table-padding-inline: .5rem;
    --table-width: calc(min(100%, var(--max-width)) + var(--table-padding-inline) * 2);
    --tag-size: .4rem;
    --sidebar-stretch: 110%;

    --legend-border: var(--fg);
    --legend-lh: .5;
    --legend-wh: calc(1ex + 2px);
    --legend-valign: baseline;

    /**********/
    /* Layout */
    /**********/

    > :where(:not(.navbox, .wiki-rs-categories, .reflist, .refbegin, .portal-bar, .sister-bar, .wikitable)) {
        max-width: var(--max-width);
    }

    /*
    The standard `* + *` rule for layout cannot be used because many templates
    break if the renderer tries to wrap all phrasing content in a `<p>`.
    'Template:Documentation' is one example, where `.documentation-startbox`
    uses `display: flex` with `<span>` children, so the flex layout breaks if
    they are wrapped.

    Instead, all the supported non-phrasing content elements are selected using
    a zero-specificity `:where` selector.
    */
    :where(:is(blockquote, center, div, dl, figure, h1, h2, h3, h4, h5, h6, ol, p, pre, table, ul):not(:first-child)),
    > :first-child,
    > [class] /* Template:Mbox, etc. override flow when they should not */
    {
        margin-top: var(--box-margin);
    }

    audio {
        height: 1rlh;
        vertical-align: top;
    }

    audio, video {
        max-width: 100%;
    }

    ol, ul, dl {
        padding-left: var(--ol-gutter);

        > * + * {
            margin-top: calc(var(--box-margin) * .25);

            .plainlist & {
                margin-top: 0;
            }

            > :is(ol, ul, dl) {
                margin-top: calc(var(--box-margin) * .25);
            }
        }
    }

    /* In MediaWiki, these empty elements would get `.mw-empty-elt`. Technically
       it would hide the display of elements with (1) no attributes and (2) only
       whitespace, but we’ll do it this way instead until it turns out we can’t.
       In particular, this hides bogus empty elements caused by list
       constructions like this:

       ```
       * {{List-item-generating template}}
       ```

       (This expands to `* \n* <template content>` due to the T2529 rule.)

       It appears that table rows should not receive this treatment since,
       apparently, empty table rows are used to fix up styles in the presence of
       rowspans, as in 'Template:Largest cities'.
    */
    :is(li, p):not([class], [style]):empty {
        display: none;
    }

    :is(ol, ul):not([class]) > * {
        padding-left: .1rem;

        .plainlist &,
        /* TODO: Too many templates rely on list items having no padding, like
        navbar-brackets from 'Template:Navbar' */
        &[class] {
            padding-left: 0;
        }
    }

    ul {
        padding-left: 1rem;
    }

    dl {
        padding-left: 0;
    }

    /* Because this element is extremely heavily abused as a mechanism for indenting
    content, we have little choice but to also do that */
    dd {
        margin-left: 1rem;
    }

    .wiki-rs-categories {
        border-top: .25rem solid currentColor;
        clear: both;
        font-family: var(--sans);
        font-size: 95%;
        font-variant-numeric: normal;
        font-weight: 350;
        list-style: none;
        padding: .5rem 0;
        margin-top: var(--footer-margin);

        &::before {
            content: 'in: ';
            font: italic 600 1em var(--serif);
        }

        > * {
            display: inline;
        }

        > * + * {
            margin-top: 0;

            &::before {
                content: ' / ';
            }
        }
    }

    blockquote, dd, li, p {
        /* 'Toronto' gets a lot of bad character distribution with
           shorter hyphenation limits */
        hyphenate-limit-chars: 6 3 4;
        hyphens: auto;
        text-align: justify;
        text-justify: distribute;
        text-justify: inter-character;
    }

    * + h2 {
        margin-top: 5rem;
    }

    * + h3 {
        margin-top: calc(var(--box-margin) * 1.5);

        + p,
        + ul,
        + ol,
        + dl,
        + :is(.mw-halign-right, .mw-halign-left, .floatright),
        + :is(.mw-halign-right, .mw-halign-left, .floatright) + * {
            margin-top: 0;
        }
    }

    :is(h4, h5, h6) + * {
        margin-top: 0;

        &:is(.mw-halign-right, .mw-halign-left) + * {
            margin-top: 0;
        }
    }

    * + dt {
        margin-top: var(--box-margin);
    }

    /******************/
    /* Common classes */
    /******************/

    .redirectText,
    .mw-redirectedfrom {
        font-family: var(--sans);

        &::before {
            content: '⮎ ';
        }
    }

    .mw-redirectedfrom::before {
        content: '⤷ ';
    }

    .selflink {
        font-weight: var(--bold);
    }

    .monospaced {
        font-family: var(--mono);
    }

    .error {
        color: rebeccapurple;
        font-family: var(--sans);
        font-weight: normal;
    }

    .nowrap {
        white-space: nowrap;
    }

    /* 'Template:Time Persons of the Year' puts `.wrap` inside `.nowrap`, which
       is a load-bearing pattern for not breaking layout. */
    .wrap {
        white-space: normal;
    }

    .wikitable,
    .tracklist, /* 'Template:Track listing' */
    .us-census-pop, /* 'Template:US Census population' */
    .bar-chart, /* 'Template:Bar chart' */
    [data-wiki-rs~=template-historical-populations] /* 'Template:Historical populations' */
    {
        border: 0;
        border-bottom: thin solid var(--border-fg);
        border-collapse: collapse;
        font-variant-numeric: tabular-nums;
        margin-inline: var(--table-margin-inline);
        width: var(--table-width);

        tbody > tr:nth-child(2n) {
            background-color: var(--shade-bg);
            /* For the case where there are shaded rowspans, ensure they are
            visually separated */
            border-top: thin solid var(--bg);
        }

        caption, td, th {
            background-color: transparent;
            border: 0;
        }

        caption {
            font-family: var(--sans);
            padding: 0;
        }

        td, th {
            padding: var(--table-padding-block) var(--table-padding-inline);
            text-align: start;
        }

        th {
            font-variant-numeric: tabular-nums;

            &[colspan] {
                text-align: center;
            }
        }

        tr:first-child > th {
            vertical-align: bottom;
        }

        /* this crazy nonsense is just trying to make it so that the top row(s)
           of headings in a table have borders to separate them from the table
           data, whilst making sure that row headings do not get underlined */
        tr:first-child > th:not([scope=row]),
        tr:first-child + tr:not(:has(td)) > th,
        th[scope=col] {
            border-bottom: thin solid var(--border-th);
        }

        tr:first-child + tr:not(:has(td)) {
            border-top: 0;
        }

        &.floatright,
        &.us-census-pop-right, /* 'Template:US Census population' */
        &.bar-chart-right,
        &[data-wiki-rs~=template-historical-populations], /* 'Template:Historical populations' */
        &[style*="float:right"],
        &[style*="float: right"],
        &[style*="float:left"],
        &[style*="float: left"]
        {
            max-width: 50cqw;
            /* !important: 'Crazy Taxi' */
            margin-left: var(--figure-margin) !important;
            margin-bottom: var(--figure-margin) !important;
            transform: var(--aside-gutter-align);
            width: auto;
        }

        /* 'Mount Everest' manually floats a table right after a floated right
           figure and inevitably sad things happen */
        &[style*="float:right"],
        &[style*="float: right"] {
            clear: right;
        }

        &[style*="float:left"],
        &[style*="float: left"]
        {
            margin-left: 0 !important;
            margin-right: var(--figure-margin) !important;
            transform: translateX(var(--table-margin-inline));
        }
    }

    /* 'Mount Everest' does float left and clear */
    .wikitable:is(
        .floatleft, [style*="float:left"], [style*="float: left"],
        .floatright, [style*="float:right"], [style*="float: right"]
    ):where(:not(:has(+ [style*="clear"]))) {
        font-family: var(--sans);
        font-stretch: var(--side-table-stretch);
        font-size: unset !important;
        font-variant-numeric: tabular-nums;

        caption {
            font-stretch: normal;
        }
    }

    .floatleft {
        clear: left;
        float: left;
        margin-bottom: var(--figure-margin);
        margin-right: var(--figure-margin);
    }

    .floatright,
    .tright, /* 'Template:Thumb image' */
    .us-census-pop-right /* 'Template:US Census population' */
    {
        clear: right;
        float: right;
        margin-bottom: var(--figure-margin);
        margin-left: var(--figure-margin);
        transform: var(--aside-gutter-align);
    }

    /* :-((((( */
    /* 'Chelyabinsk meteor' commits this atrocity */
    [style*="float:right"]:has(> .wikitable[style*="float:right"][style*="margin"]) {
        margin-left: var(--figure-margin);
        > * {
            margin-left: 0 !important;
            margin-right: var(--table-margin-inline) !important;
            width: auto;
        }
    }

    > .wikitable[style*="border"][style*="margin"], /* 'Toronto' */
    .succession-box /* 'Template:S-start' */
    {
        margin-inline: var(--table-margin-inline) !important;

        * + & {
            margin-top: var(--box-margin) !important;
        }
    }

    /* 'Toronto' */
    > .wikitable[style*="border"][style*="margin"] {
        border-width: 0 0 thin !important;
    }

    /***********/
    /* Figures */
    /***********/

    figure {
        overflow: hidden;

        &.mw-halign-left,
        &.mw-halign-right {
            max-width: var(--aside-max);

            p + & {
                margin-top: var(--box-margin);
            }
        }

        &.mw-halign-left {
            clear: left;
            float: left;
            margin-right: var(--figure-margin);
            margin-bottom: var(--figure-margin);
            min-width: var(--aside-min);
        }

        &.mw-halign-right {
            clear: right;
            float: right;
            margin-left: var(--figure-margin);
            margin-bottom: var(--figure-margin);
            min-width: var(--aside-min);
            transform: var(--aside-gutter-align);
        }

        img {
            display: block;
        }
    }

    figcaption {
        font-family: var(--sans);

        /* Used in 'Canada' */
        .legend {
            margin-top: 0;
        }

        span.legend + span.legend {
            margin-left: .25em;

            &::before {
                content: ' ';
                white-space: normal;
            }
        }

    }

    /* Used in 'Canada' and 'McDonnell Douglas MD-11' */
    .legend-color {
        border-color: var(--legend-border);
        line-height: var(--legend-lh);
        min-width: var(--legend-wh);
        height: var(--legend-wh);
        vertical-align: var(--legend-valign);
    }

    /*************************/
    /* Template:!mxt         */
    /* Template:Section link */
    /*************************/

    [style*="font-family: monospace"],
    [style*="font-family:monospace"] {
        font-family: var(--mono) !important;
    }

    /********************/
    /* Template:Hatnote */
    /********************/

    .hatnote.hatnote {
        margin-bottom: 0;
        padding-left: 0;

        :is(h2, h3, h4, h5) + &,
        .hatnote + & {
            margin-top: 0;
        }
    }

    /********************/
    /* Template:Infobox */
    /* Template:Sidebar */
    /********************/

    .infobox, .sidebar {
        --tag-size: 1rem;

        border: solid var(--fg);
        border-width: 3px 0;
        border-collapse: separate;
        clear: right;
        /* TODO: This breaks baseline alignment of the nav. */
        float: right;
        font-family: var(--sans);
        margin: 0 0 var(--figure-margin) var(--figure-margin);
        padding: 0;

        /* 'Elizabeth II' nests infoboxes */
        /* 'Template:Climate chart' floats to the left too */
        .mw-parser-output > &:not([style*="float: left"]) {
            max-width: var(--aside-max);
            min-width: var(--aside-min);
            transform: var(--aside-gutter-align);
        }

        :where(ul) {
            padding-left: 0;
        }

        * + & {
            /* !important: 'Wikipedia' */
            margin-top: var(--box-margin) !important;
        }

        &.sidebar {
            font-size: inherit;
            max-width: 18rem;

            /* !important: 'Template:History of Ryukyu' */
            .infobox[style*="width:100%"] {
                width: 100% !important;
            }
        }

        td, th {
            padding: 0;
            vertical-align: top;
        }

        th {
            font-stretch: var(--side-table-stretch);
        }

        .infobox-above,
        .infobox-title,
        .sidebar-title,
        .sidebar-title-with-pretitle {
            background-color: transparent !important; /* !important: 'Fart' */
            font-size: 1rem !important; /* !important: 'Crazy Taxi' */
            font-stretch: 120%;
            font-style: normal !important; /* !important: 'Crazy Taxi' */
            font-weight: bold;
            line-height: 1.2;

            /* !important: 'Minnesota' */
            [style*=font-size] {
                font-size: inherit !important;
            }
        }

        .infobox-subheader {
            background-color: transparent;
        }

        /* !important: 'Template:Conservation status' */
        .sidebar-title > [style*=font-size] {
            font-size: smaller !important;
            font-stretch: normal;
            margin-top: 0;
        }

        .sidebar-pretitle {
            font-size: 95%;
        }

        .sidebar-pretitle,
        .sidebar-heading,
        .sidebar-content,
        .sidebar-below {
            background-color: transparent !important;
            color: inherit !important;

            /* !important: 'Template:Conservation status' */
            :any-link > [style*=color] {
                color: inherit !important;
            }

            /* !important: 'Template:Content policy list' */
            > [style*="font-size:120%"] {
                font-size: inherit !important;
                font-stretch: var(--sidebar-stretch);
            }
        }

        .sidebar-below {
            font-weight: normal;
            padding-top: calc(var(--box-margin) * .5);
        }

        .sidebar-content {
            text-align: left !important;
        }

        .sidebar-navbar {
            font-stretch: var(--sidebar-stretch);
        }

        .sidebar-title-with-pretitle {
            text-align: center;

            .tmp-color {
                color: inherit !important;
            }
        }

        .sidebar-image {
            border-top: thin solid currentColor;
            padding-top: calc(var(--box-margin) * .75);
        }

        .sidebar-list-title {
            /* !important: 'Template:Sociology' */
            background: transparent !important;
            font-stretch: var(--sidebar-stretch);
            padding: 0;
            line-height: inherit;
        }

        .sidebar-list-content {
            margin-top: 0;
        }

        tr:has(> .sidebar-content > .sidebar-list) + tr > .sidebar-content > .sidebar-list {
            margin-top: calc(var(--box-margin) * .5);
        }

        /* This is actually redundant information; the title of the page,
           and the first graf of the page, both say what it is. It is not
           necessary to say it a third time. */
        &.hproduct .infobox-above {
            display: none;
        }

        &.ib-country, &.ib-settlement {
            line-height: unset;

            /* !important: 'Canada' */
            .paragraphbreak {
                margin-top: 0 !important;
            }

            :is(td, th, .ib-country-anthem) {
                border: 0;
                margin: 0;
                padding: 0;
            }

            tr:has(> .infobox-image) + tr > .infobox-full-data,
            tr:has(> .infobox-image) + tr + tr > .infobox-full-data,
            tr:has(> .infobox-image) + tr + tr + tr > .infobox-full-data {
                padding-top: .5rem;
            }

            /* TODO: This is a reapplication of a rule that already exists
               due to specificity conflicts */
            .infobox-label {
                padding-right: .3rem;
            }

            .infobox-header {
                padding-top: .25rem;
            }

            /* !important: 'Canada' */
            .infobox-image div[style] {
                padding: 0 !important;
            }
        }

        .infobox-label {
            padding-right: .3rem;
            line-height: 1.2;
            text-align: start;
            /* keep first baseline alignment w/ reduced line height */
            transform: translateY(.185em);

            > * {
                /* !important: At least 'Template:Infobox company' creates an
                   inline block with inline top padding style which breaks the
                   text grid */
                padding-top: 0 !important;
            }
        }

        /* .ib-company .infobox-data changes the line height,
           so does .ib-settlement */
        .infobox-data {
            line-height: unset;
        }

        .infobox-image {
            text-align: center;

            img {
                display: block;
                margin-inline: auto;
                width: 100%;
            }

            * + * {
                margin-top: 0;
            }
        }

        .infobox-header {
            /* !important: 'Rust (programming language)' */
            background-color: transparent !important;
            /* !important: 'Minnesota' */
            border-top: 0 !important;

            &.description {
                font-stretch: normal;
            }

            /* Because it is a table cell, to get a horizontal rule with
               spacing, choose poison: a nasty selector that walks backward, or
               a pseudo-element */
            /* padding-top: .6rem;
            &::before {
                border-top: thin solid var(--fg);
                content: '';
                display: block;
                transform: translateY(.1rem);
            } */
        }

        .infobox-caption,
        .sidebar-caption {
            font-style: italic;
            margin-top: 0;
        }

        * + .plainlist {
            margin-top: 0;
        }

        /* 'United States Civil Administration of the Ryukyu Islands' */
        .ib-country-names {
            font-stretch: normal;
            margin-top: calc(var(--box-margin) * .25);
            padding-top: 0;
        }

        /* 'Turkey (bird)', 'Cat', etc. */
        &.biota {
            tr, th {
                background: transparent !important;
            }

            > tbody > :first-child > th {
                &::first-line {
                    font-stretch: var(--sidebar-stretch);
                }

                > br {
                    display: none;
                }

                [style*="font-size: 85%"] {
                    font-size: 1em !important;
                }
            }

            td:first-child:not(:last-child) {
                font-stretch: var(--side-table-stretch);
                font-weight: var(--bold);
            }
        }

        /* 'Cristiano Ronaldo' */
        &.ib-youtube {
            .ib-youtube-above,
            .ib-youtube-header {
                color: var(--fg) !important;
            }
        }

        &[style*="line-height: 1.2em"],
        [style*="line-height: 1.2em"] {
            line-height: unset !important;
        }
    }

    /*******************/
    /* Template:Navbox */
    /*******************/

    /* nest everything to increase specificity, since the templatestyles uses
       complex selectors with high specificities */
    .navbox {
        &.navbox,
        .navbox-title,
        .navbox-group,
        .navbox-subgroup,
        .navbox-list,
        .navbox-even,
        .navbox-odd,
        .navbox-abovebelow {
            /* !important: 'Sociology' */
            background-color: transparent !important;
            border: 0;
            margin-top: 0;
        }

        &.navbox {
            border-top: 3px solid currentColor;
            /* !important: 'Crazy Taxi' */
            padding: 0 !important;

            /* Lots of empty garbage elements inside navboxes */
            div:empty {
                display: none;

                + * {
                    margin-top: 0;
                }
            }

            li {
                padding-left: 0;
            }
        }

        /* There is a much more pleasant way to do this, which is to use border-top
        on `tr + tr`. Unfortunately, to make sure there is a bottom border on a
        last row but *not* on a `.navbox-abovebelow`, the border has to be put on
        the bottom so it can be erased by `.navbox-abovebelow`. */
        tr > :is(.navbox-title, .navbox-abovebelow, .navbox-group, .navbox-image, .navbox-list) {
            border-bottom: thin solid var(--border-fg);
        }
        .navbox-subgroup tr:last-child > :is(.navbox-abovebelow, .navbox-group, .navbox-image, .navbox-list) {
            border-bottom: 0;
        }
        tr:last-child > .navbox-abovebelow {
            border-bottom: 0;
        }

        .navbox-list + .navbox-list {
            /* !important: 'Template:IBM personal computers' */
            border-left: thin solid var(--border-fg) !important;
        }

        /* 'Template:Mozilla' uses one of these weirdo hybrids */
        .navbox-list-with-group > div:first-child:not(:empty) {
            &:has(~ .navbox-subgroup) {
                /* !important: 'Template:Mozilla' */
                padding-inline: 1rem !important;
            }

            ~ .navbox-subgroup {
                border-top: thin solid var(--border-fg);
            }
        }

        .navbox-title,
        .navbox-group,
        .navbox-abovebelow {
            font-family: var(--sans);
        }

        /* 'Template:Solar system' */
        .navbox-group[scope=row][style*="text-align"] {
            text-align: right !important;
        }

        .navbox-columns-table {
            > tbody > tr > .navbox-list + .navbox-list > .navbox-subgroup {
                border-left: thin solid var(--border-fg) !important;
            }
        }

        .navbox-abovebelow {
            font-size: .9rem;
        }

        .navbox-title {
            font-size: 1rem;
            font-stretch: var(--sidebar-stretch);

            > :not(.navbar) {
                /* !important: Pages like 'Crazy Taxi' on an anonymous
                container */
                font-size: 1rem !important;
            }
        }

        .navbox-title,
        .navbox-abovebelow,
        .navbox-group {
            &[style*="box-shadow:"] {
                box-shadow: none !important;
            }
        }

        /* !important: 'Template:New York City' and 'Template:Mosques in India'
           and 'Template:Manchester United F.C.'.
           Caution is required because 'Template:Wikipedia policies and
           guidelines' uses colour differently in a way which is not so bad */
        .navbox-title,
        .navbox-title *,
        .navbox-abovebelow,
        .navbox-abovebelow :any-link *,
        .navbox-group,
        .navbox-group :any-link * {
            &[style*="color\:"] {
                color: unset !important;
            }
        }

        /* When navbox titles are rotated, as in 'Template:Carnivora', the
           inline styles rely on content-box to avoid overflow */
        .navbox-group {
            box-sizing: content-box;
        }

        .navbox-group:has(+ td .navbox-subgroup) {
            border-right: thin solid var(--border-fg);
        }

        .navbox-image {
            display: none;
        }

        /* 'Wikipedia:Five pillars' uses this */
        .navbox-columns-table {
            strong {
                font-family: var(--sans);
            }

            .navbox-list:not(.navbox-list-with-group) {
                border: 0 !important;
            }

            .navbox-list:not(:has(.navbox-subgroup)) + * {
                padding-left: calc(var(--box-margin) * .25) !important;
            }
        }
    }

    .navbox-styles {
        display: none;
    }

    /* extra specificity to override `.navbox + .navbox-styles + .navbox` */
    > * + .navbox.navbox.navbox {
        clear: both;
        margin-top: var(--footer-margin);
    }

    /*******************/
    /* Template:Navbar */
    /*******************/

    .navbar-ct-full,
    .navbar-ct-mini {
        font-size: inherit;
    }

    /***********************/
    /* Template:Portal     */
    /* Template:Portal bar */
    /***********************/

    .portalborder {
        background: var(--box-tag);
        border: 0;
        padding: .25rem var(--tag-size);

        &.portalright {
            padding-right: 0;
            transform: var(--aside-gutter-align);
        }
    }

    .portalbox-entry {
        font-family: var(--sans);
        font-size: 88%; /* match side-box */
        line-height: 1;
        height: auto;
        font-style: normal;
        font-weight: normal;
    }

    .portalbox-image,
    .portalbox-link {
        padding: 0;
    }
    .portalbox-link {
        padding-left: .3em;
    }

    .portal-bar, .sister-bar {
        font-family: var(--sans);
        margin-top: var(--footer-margin);
    }
    .portal-bar-bordered, .sister-bar {
        background-color: transparent;
        border: 0;
        border-top: thin solid var(--border-fg);
        border-bottom: thin solid var(--border-fg);
    }

    :is(.sister-bar, .portal-bar) + :is(.sister-bar, .portal-bar) {
        border-top: none;
        margin-top: 0;
    }

    /***************************************/
    /* Template:Side box (portal-adjacent) */
    /***************************************/

    .side-box {
        border: 0;
        background: var(--box-tag);
        font-family: var(--sans);
        min-width: fit-content;
        width: auto;

        .side-box-flex > * + * {
            margin-top: 0;
        }

        .side-box-text {
            padding-block: 0;
        }

        * + hr {
            margin-top: calc(var(--box-margin) * .25);
        }

        > * + * {
            margin-top: calc(var(--box-margin) * .25);
        }
    }

    .side-box-right {
        max-width: var(--aside-max);
        transform: var(--aside-gutter-align);
    }

    /***************************************/
    /* Template:Shortcut (portal-adjacent) */
    /***************************************/

    .module-shortcutboxplain {
        background: var(--box-tag);
        border: 0;
        font-family: var(--sans);
        margin: 0 0 var(--figure-margin) var(--figure-margin);
        padding: 0 0 0 var(--tag-size);

        > * + * {
            margin: 0;
        }
    }

    .module-shortcutlist {
        border: 0;
    }

    /********************/
    /* Template:Reflist */
    /********************/

    .reflist, .refbegin {
        font-size: inherit;
        margin-bottom: 0;
    }

    .reflist-columns {
        gap: calc(var(--ol-gutter) * 2);
        margin-top: 0;
    }

    .refbegin-hanging-indents > ul {
        padding-left: 2em;
        > li {
            padding-left: 0;
            text-indent: -2em;
        }
    }

    /***********************/
    /* Template:Blockquote */
    /***********************/

    blockquote, .templatequote {
        font-style: italic;
        margin-bottom: 0;
        padding-inline: 2.5rem;

        em, em em em, em em em em em {
            font-style: normal;
        }

        em em, em em em em, em em em em em em {
            font-style: italic;
        }
    }

    .templatequotecite {
        font-family: var(--sans);
        line-height: 1rlh;
        margin-top: .5em;
        text-align: end;

        em, em em em, em em em em em {
            font-style: italic;
        }

        em em, em em em em, em em em em em em {
            font-style: normal;
        }
    }

    /******************/
    /* Template:Mbox  */
    /* Template:Ambox */
    /* Template:Cmbox */
    /* Template:Fmbox */
    /* Template:Imbox */
    /* Template:Ombox */
    /* Template:Tmbox */
    /******************/

    .ambox, .ombox, .cmbox {
        background: var(--box-tag);
        border: 0;
        font-family: var(--sans);
        margin-inline: 0;

        img {
            aspect-ratio: 1;
            display: block;
        }

        /* TODO: This violates the top-only rule because of missing <p> due to
           bad parsing */
        hr {
            margin: .5rem 0 calc(.5rem - 1px);
        }

        .mw-parser-output > &:first-child {
            margin-top: var(--box-margin);
        }
    }

    .mbox-text {
        padding: 0;
    }

    .mbox-image {
        padding: .1rem .3rem 0 .3rem;
        vertical-align: top;
    }

    .mbox-empty-cell {
        padding-left: .5rem;
    }

    .mbox-small {
        margin: 0 0 var(--figure-margin) var(--figure-margin);
    }

    /**************************/
    /* Template:Documentation */
    /**************************/

    .documentation-container {
        * + & {
            border-top: 3px solid currentColor;
            margin-top: 2rem;
            padding-top: .5rem;
        }
    }

    .documentation {
        background-color: transparent;
        border: 0;
        padding: 0;
    }

    .documentation-startbox {
        align-items: baseline;
        border-bottom-color: var(--fg);
        display: flex;
        font-family: var(--sans);
        padding: 0;
        margin-bottom: 0;

        > :first-child {
            flex: 1;
        }
    }

    .documentation-heading {
        font-stretch: 120%;

        img {
            max-height: 1cap;
        }
    }

    .documentation-metadata {
        background-color: transparent;
        border: 0;
        border-top: 3px solid;
        font-family: var(--sans);
        font-style: normal;
        padding: .5rem 0 0;
        margin: 4rem 0 0;
    }

    /*******************************/
    /* Template:Video game reviews */
    /*******************************/

    .video-game-reviews {
        margin-bottom: var(--figure-margin);
        margin-left: var(--figure-margin);
    }
    .vgr-reviews caption {
        font-family: var(--sans);
    }

    .vgr-center {
        text-align: left;
    }

    .vgr-stacked {
        margin-top: calc(var(--box-margin) * .5);
    }

    .vgr-title {
        font-family: var(--sans);
    }

    /***************************/
    /* Template:Image frame    */
    /* Template:Multiple image */
    /***************************/

    .thumb {
        font-family: var(--sans);
        /* api.php?meta=siteinfo&siprop=general thumblimits maxes out at 400 */
        /* !important: 'Module:Wide image' defaults non-existing image width to
           0 (and therefore max-width to 10px) */
        &[style*="max-width\:10px"] {
            max-width: 400px !important;
        }

        .thumbcaption {
            margin-top: 0;
        }

        .multiimageinner[style*="max-width:100px"] {
            /* !important: This module blindly calculates values even if none
               are available, which means it ends up forced to 100px wide */
            max-width: 400px !important;
            width: auto !important;
        }

        .tsingle {
            margin: 0;
        }

        .trow {
            gap: calc(var(--figure-margin) / 2);

            > * {
                flex: 1 1 0%;
                min-width: 0;
            }

            .thumbimage:has(~ .text-align-center) {
                text-align: center;
            }
        }
    }

    /***********************/
    /* Template:Row header */
    /***********************/

    .table-rh {
        /* !important: Even though this template uses a class, it still also
           unconditionally inlines styles */
        background-color: transparent !important;
        color: inherit !important;
        font-family: var(--sans);
        line-height: 1.2;

        > .hatnote {
            font-weight: normal !important;
            margin-top: calc(var(--box-margin) * .5);
        }
    }

    /*****************************/
    /* Template:Spoken Wikipedia */
    /*****************************/

    .spoken-wikipedia {
        border: 0;
        border-top: 3px solid currentColor;
        font-family: var(--sans);
    }
    .spoken-wikipedia-disclaimer {
        hyphens: manual;
    }

    /************************/
    /* Template:Compact TOC */
    /************************/

    .toc {
        border-top: 3px solid currentColor;
        font-family: var(--sans);

        .toctitle {
            font-stretch: 120%;

            + * {
                border-top: thin solid var(--border-fg);
                margin-top: 0;
                padding-top: calc(var(--box-margin) * .25);
            }
        }

        > div {
            text-align: center;
        }
    }

    /**********************/
    /* Template:Quote box */
    /**********************/

    .quotebox {
        background: transparent;
        border: 0;
        border-bottom: thin solid currentColor;
        border-top: 3px solid currentColor;
        padding: calc(var(--box-margin) * 2) var(--box-margin) calc(var(--box-margin) * 2) calc(var(--box-margin) * 2);

        &.floatright,
        &.floatleft {
            max-width: var(--aside-max);
            min-width: var(--aside-min);
            margin: var(--box-margin) calc(var(--box-margin) * -1) var(--figure-margin) var(--figure-margin);
        }

        &.floatleft {
            margin-inline: calc(var(--box-margin) * -1) var(--figure-margin);
        }

        .left-aligned {
            text-align: justify;
        }

        cite {
            font-style: italic;

            /* 'Social class' uses this and it looks bad */
            &.left-aligned {
                text-align: right;
            }
        }
    }

    /**************************************/
    /* Template:Timeline of release years */
    /**************************************/

    .release-timeline {
        border-collapse: separate;
        border-spacing: 0 1px;
        clear: right;
        font-family: var(--sans);
        font-size: 95%;
        float: right;
        line-height: inherit;
        margin: 0 calc(var(--box-margin) * -1) var(--figure-margin) var(--figure-margin);
        padding: 0;
        transform: var(--aside-gutter-align);
        width: auto;

        > caption {
            border-bottom: thin solid var(--border-th);
        }

        td, th {
            line-height: 1.2;
        }

        th[style*=border-right] {
            border-right-width: .5ch !important;
        }

        td {
            font-stretch: var(--side-table-stretch);
        }
    }

    /************************************/
    /* Template:Template journal inline */
    /************************************/

    .tj-tape {
        font-family: var(--mono);
    }

    /********************/
    /* Template:Div col */
    /********************/

    * + .div-col {
        margin-top: var(--box-margin);
    }

    .div-col-rules {
        column-rule: none;
    }

    /**************************/
    /* Template:Climate chart */
    /**************************/

    /* .infobox is for extra specificity */
    [data-wiki-rs~=template-climate-chart].infobox {
        --heat-gradient: linear-gradient(to bottom, red 20%, blue 80%);

        border: none !important;
        font-variant-numeric: lining-nums;
        margin-bottom: var(--figure-margin) !important;

        &[style*="float\: left"] {
            margin-right: var(--figure-margin) !important;
        }

        &[style*="float\: right"] {
            margin-left: var(--figure-margin) !important;
        }

        /* axis display, part 1 */
        [style*="bottom:dotted"] {
            display: none;
        }

        /* axis display, part 2 */
        tr:has(> td > [style*="position:relative"]) {
            background: #fff url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" width="3" height="2"><circle cx="1" cy="1" r=".5" fill="%23999" /></svg>')  repeat-x 0 calc(50% + .5em);
            position: relative;

            > :first-child::before {
                background-image: var(--heat-gradient);
                content: '';
                bottom: 1.5em;
                left: 0;
                mix-blend-mode: screen;
                pointer-events: none;
                position: absolute;
                right: 0;
                top: 0;
                z-index: 1;
            }
        }

        [data-wiki-rs~=template-climate-chart-celsius-column],
        [data-wiki-rs~=template-climate-chart-celsius-column-i],
        [data-wiki-rs~=template-climate-chart-fahrenheit-column],
        [data-wiki-rs~=template-climate-chart-fahrenheit-column-i] {
            /* improve legibility of labels on the axis */
            span {
                background-color: #fff;
                color: #000 !important;
                padding-inline: .15em;
                margin-inline: -.15em;

                &[style*="font-size\:70%"] {
                    font-size: 80% !important;
                    font-stretch: var(--side-table-stretch);
                }
            }

            /* the actual temperature and precipitation bars */
            div[style*="background\:#e44"],
            div[style*="background\:#ace"] {
                background: var(--bar-fill) !important;
                border: thin solid #000;
                /* to stop unscaled giant precipitation interfering with the
                   title link */
                pointer-events: none;
            }

            div[style*="background\:#ace"] {
                background: var(--bar-fill-alt) !important;
            }
        }

        th {
            border-top: thin solid var(--fg);
            font-size: 1rem !important;
        }

        /* legend swatches */
        td[colspan] > span:first-child:not(.reference) {
            border: 1px solid var(--legend-border);
            color: transparent !important;
            display: inline-block;
            line-height: var(--legend-lh);
            height: var(--legend-wh);
            vertical-align: var(--legend-valign);
            width: var(--legend-wh);

            &[style*="red"],
            &[style*="#aaccee"] {
                color: transparent !important;
                background: var(--heat-gradient), var(--bar-fill), #fff !important;
                background-blend-mode: screen, normal, normal;
            }

            &[style*="#aaccee"] {
                color: transparent !important;
                background: var(--heat-gradient), var(--bar-fill-alt), #fff !important;
            }
        }

        .infobox {
            margin-right: 0 !important;
            margin-top: calc(var(--box-margin) * .5) !important;

            th {
                /* The emulated margin-top of a secondary conversion chart */
                padding-bottom: calc(var(--box-margin) * .25);
            }
        }

        > tbody {
            > tr > td > .infobox {
                /* The margin-top of the primary conversion chart */
                margin-top: calc(var(--box-margin) * .25) !important;
            }

            > tr:first-child > th {
                border-top: 3px solid var(--fg);
                font-stretch: var(--sidebar-stretch);
            }
        }
    }

    /************************/
    /* Template:Weather box */
    /************************/

    [data-wiki-rs~=template-weather-box] {
        .wikitable,
        /* A lot of pages like 'Jakarta' and 'Tromsø' shove an untemplated
           “climatic data” table right after the weather box */
        + .wikitable {
            border-bottom: none;
            width: calc(100% + var(--table-padding-inline) * 2) !important;

            td {
                border: solid var(--bg);
                border-width: thin 0 0 thin;
                font-family: var(--sans);
                font-size: 90%;
                text-align: center;
                text-align: "." right;
                padding-inline: calc(var(--table-padding-inline) * .5);
                width: 6%;
                white-space: nowrap;

                &::first-line {
                    font-size: 1rem;
                }

                &:last-child {
                    padding-inline: var(--table-padding-inline);
                }

                &[style*="color:"] {
                    background-image: var(--bar-fill-light) !important;
                    background-blend-mode: soft-light;
                }
            }

            tr:first-child > th {
                font-weight: normal;
                &::first-line {
                    font-weight: var(--bold);
                }
            }

            tr:nth-child(2) > th[scope=row] {
                border-bottom: thin solid var(--border-th);
            }

            tr:last-child,
            tr:nth-last-child(2):has(> [colspan]) {
                background: transparent;

                > * {
                    /* !important: 'Tromsø' climatic data table */
                    background: transparent !important;
                    /* hiding the border gap requires using a unit with a known
                    size; `thin` is undefined in CSS */
                    border-top: 1px solid var(--border-fg);
                    line-height: 1rlh;

                    /* hiding the border gap */
                    &:last-child {
                        position: relative;

                        &::before {
                            content: '';
                            position: absolute;
                            top: -1px;
                            left: 0;
                            right: 0;
                            border-top: 1px solid var(--border-fg);
                        }
                    }
                }

                + tr:last-child > * {
                    border-top: 0;

                    &:last-child::before {
                        display: none;
                    }
                }
            }

            th[scope=col] {
                /* hiding the border gap requires using a unit with a known
                   size; `thin` is undefined in CSS */
                border-bottom-width: 1px;
                text-align: center;

                &[style*="border-left-width\:medium"] {
                    position: relative;
                    &::after {
                        border-bottom: 1px solid var(--border-th);
                        bottom: 0;
                        content: '';
                        left: 0;
                        position: absolute;
                        /* "thin" and "medium" are unspecified in CSS */
                        width: 12px;
                        transform: translate(-6px, 1px);
                    }
                }
            }
        }

        /* !important: 'Jakarta' */
        + .wikitable {
            margin-inline: var(--table-margin-inline) !important;

            tr:nth-child(2) > th {
                border-bottom: 1px solid var(--border-th);

                &:last-child {
                    position: relative;
                    &::after {
                        border-bottom: 1px solid var(--border-th);
                        bottom: 0;
                        content: '';
                        left: 0;
                        position: absolute;
                        /* "thin" and "medium" are unspecified in CSS */
                        width: 12px;
                        transform: translate(-6px, 1px);
                    }
                }
            }
        }
    }

    /***********************************/
    /* Template:Historical populations */
    /* Template:US Census population   */
    /***********************************/
    .us-census-pop,
    [data-wiki-rs~=template-historical-populations] {
        border-bottom: none;
        margin: 0 var(--table-margin-inline) var(--figure-margin) var(--figure-margin) !important;

        caption {
            border-bottom: thin solid var(--border-th);
            padding: 0 !important;
        }

        th, td {
            padding: var(--table-padding-block) var(--table-padding-inline) !important;
        }

        td {
            font-family: var(--sans);
            font-variant-numeric: tabular-nums;
            font-stretch: var(--side-table-stretch);
        }

        tr:last-child:last-child:last-child {
            background-color: transparent;

            > * {
                border-top-color: var(--border-fg) !important;
                border-top-width: thin !important;
                font-stretch: normal;
            }
        }
    }

    /* 'Tromsø' */
    [data-wiki-rs~=template-historical-populations][style*="float:none"] {
        font-size: 1em !important;
        margin-inline: var(--table-margin-inline);
        max-width: none;
        width: var(--table-width);

        td:not(:first-child) {
            padding-left: calc(var(--table-padding-inline) * .5) !important;
        }

        td:not(:last-child) {
            padding-right: calc(var(--table-padding-inline) * .5) !important;
        }
    }

    [data-wiki-rs~=template-historical-populations]:where([style*="float:right"], [style*="float:left"]) {
        caption, th {
            font-stretch: var(--side-table-stretch);
        }
    }

    /*********************/
    /* Template: Bar box */
    /*********************/

    .barbox {
        font-family: var(--sans);
        font-stretch: var(--side-table-stretch);
        overflow-x: visible !important;

        table {
            margin-inline: var(--table-margin-inline);
            width: var(--table-width);
        }

        th, td {
            font-variant-numeric: tabular-nums;
        }

        tr:nth-child(2) {
            display: none;
        }

        tr:first-child,
        tr:last-child {
            border-bottom: thin solid var(--border-th);
        }

        tr:first-child {
            border-color: var(--fg);

            > th {
                padding-inline: var(--table-padding-inline);
            }
        }

        > div {
            background: transparent !important;
            border: none !important;
            padding: 0 !important;
            font-size: 1rem !important;
        }
    }

    /*************************/
    /* Template: Bar chart   */
    /* Template: Bar percent */
    /*************************/

    .bar-chart {
        border: none;

        caption {
            font-family: var(--sans);
            font-weight: normal;
            font-stretch: normal;
        }

        /* TODO: Whitespace parsing error generating graf tags? */
        p {
            display: none;
        }
    }

    /* THIS TEMPLATE IS INCREDIBLY OBNOXIOUS. */
    .bar-chart tr:not(:first-child):nth-child(2n):hover {
        background-color: var(--shade-bg);
    }

    .bar-chart-right {
        font-stretch: var(--side-table-stretch);
    }

    [data-wiki-rs~=template-bar-percent],
    .bar-chart tr {
        &:nth-child(2n) {
            background-color: var(--shade-bg);
        }

        > td:first-child {
            min-width: 0 !important;
        }

        > td:nth-child(2) {
            border-left: thin solid var(--fg) !important;
            border-right: none !important;
            min-width: 100px;
            padding: 0;
            width: auto !important;
        }

        > td:last-child {
            padding-right: var(--table-padding-inline);
        }
    }

    [data-wiki-rs~=template-bar-percent] > td > div,
    .bar-chart-bar-line {
        background: var(--bar-fill) !important;
        border: solid black;
        border-width: thin thin thin 0;
        display: inline-block;
        vertical-align: middle;
        height: 1em;
    }

    .bar-chart-bar {
        display: inline-block;
        white-space: nowrap;
        width: auto !important;
    }

    .bar-chart-bar-numbers {
        background: var(--bg);
        background-clip: content-box;
        font-family: var(--sans);
        font-size: 90%;
        font-stretch: 110%;
        position: static;
        margin-left: 0.15em;
    }

    /********************/
    /* Template:S-start */
    /********************/

    .succession-box.succession-box {
        border-top: thin solid var(--border-fg);

        .navbox & {
            border: none;
            margin: 0 !important;
            width: 100%;
        }

        * {
            text-align: inherit;
        }

        * + * {
            margin-top: 0;
        }
    }

    /***************************/
    /* Template:Largest cities */
    /***************************/

    [data-wiki-rs~=template-largest-cities] {
        > table {
            border-inline: none !important;
            border-color: var(--border-fg) !important;
            border-top: 3px solid currentColor !important;
            font-size: 1em !important;
            font-variant-numeric: tabular-nums;
            margin-inline: var(--table-margin-inline) !important;
            width: calc(100% + var(--table-padding-inline) * 2) !important;
        }

        th {
            border-bottom: thin solid var(--border-fg);

            > * + * {
                margin-top: 0;
            }

            span[style*=font-size] {
                font-stretch: var(--sidebar-stretch);
            }
        }

        tr:nth-child(2n + 1) td:not([rowspan]) {
            background-color: var(--shade-bg);
        }

        td {
            padding: .25em;

            &:has(+ .largestCities-cell-background) {
                padding-right: 1em;
            }

            &:not([rowspan]) + .largestCities-cell-background {
                border-left: thin solid var(--border-fg);
            }
        }
    }

    .largestCities-cell-background {
        background-color: transparent;
    }

    /******************************/
    /* Template:Phanerozoic 220px */
    /******************************/

    [data-wiki-rs~=template-phanerozoic-220px] {
        font-size: 1em !important;

        > * {
            background: transparent !important;
        }

        > [name=Range] {
            pointer-events: none;

            * {
                font-stretch: normal;
                font-size: 90% !important;
                font-weight: bold;
            }
        }

        > * + [data-wiki-rs~=template-fossil-range-bar] {
            border-left: thin dotted var(--fg);
        }

        * {
            font-stretch: 50%;
            /* TODO: This is part of the losing battle of having universal top
               margin on block-level items inside all containers */
            margin-top: 0;
            padding: 0 !important;
        }

        a {
            display: block;
            line-height: 100%;

            &:any-link {
                font-weight: normal;
            }
        }
    }

    /**************************/
    /* Template:Clade gallery */
    /**************************/

    > .clade-gallery.clade-gallery {
        display: block;
        font-family: var(--sans);
        margin-inline: 0;

        * + & {
            margin-top: var(--box-margin);
        }

        .main-caption,
        .main-content {
            padding: 0;
        }

        .main-content {
            display: flex;
            flex-wrap: wrap;
            gap: var(--box-margin);
            margin-top: 0;

            > * {
                flex: 1;
            }
        }

        .gallery-element {
            border: none;
        }

        .cladogram.cladogram {
            font-stretch: var(--side-table-stretch);
            padding: 0;
        }

        .clade * {
            border-color: var(--border-clade);
        }

        .clade-leaf {
            &:first-letter {
                padding-left: .15em;
            }

            b {
                font-stretch: normal;
            }

            img {
                /* TODO: max-height is just because of no media support to keep
                   things from being crazy */
                max-height: 1em;
                vertical-align: middle;
            }
        }
    }

    /**********************/
    /* Template:Pie chart */
    /**********************/

    .pie-thumb .smooth-pie-container {
        padding: 0;
    }

    .smooth-pie,
    .smooth-pie-legend .l-color {
        filter: saturate(200%) contrast(200%) brightness(200%) hue-rotate(50deg);
    }
    .smooth-pie {
        /* TODO: Sadly, graf tags cannot be injected after anything that looks
           like a block. */
        p { display: none; }

        &,
        > * {
            margin-top: 0;
        }

        &::before {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            z-index: 1;
            pointer-events: none;
            content: '';
            background: var(--bar-fill);
            border-radius: 50%;
            mix-blend-mode: overlay;
        }

        [title] {
            cursor: help;
        }
    }

    .smooth-pie-legend .l-color {
        background-image: var(--bar-fill) !important;
        background-size: 4px 4px !important;
        background-blend-mode: overlay;
    }

    /***********************/
    /* Template:Ahnentafel */
    /***********************/

    [data-wiki-rs~=template-ahnentafel] {
        font-family: var(--sans);

        > table {
            border: none !important;
            font-size: 1em !important;
        }

        .ahnentafel {
            font-stretch: var(--side-table-stretch);

            td {
                border-color: var(--border-th) !important;
            }

            td[style*=background-color] {
                background-image: var(--bar-fill-light);
                background-position: 0;
            }
        }
    }

    /*********************/
    /* Template:Fix span */
    /* Template:CN span  */
    /*********************/

    .citation-needed-content {
        border: 0 !important;
        padding-inline: 0 !important;
        text-decoration: underline wavy var(--border-th);

        + .Template-Fact {
            margin-left: -.15em !important;
            margin-right: .15em;
        }
    }
}
